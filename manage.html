<!DOCTYPE html>
<html>
<head>
    <title>사용자 관리</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Basic styling for better presentation */
        body { font-family: sans-serif; margin: 2em; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; cursor: pointer; }
        tr.active { background-color: #e0e0e0; }
        form { margin-bottom: 2em; }
        label { display: inline-block; width: 80px; }
        input { margin-bottom: 0.5em; }
        .buttons { margin-top: 1em; }

        /* Responsive layout for mobile devices */
        @media screen and (max-width: 600px) {
            body {
                margin: 1em;
            }

            /* Hide the table header on mobile */
            #userTable thead {
                display: none;
            }

            /* Make table rows look like cards */
            #userTable tr {
                display: block;
                margin-bottom: 1em;
                border: 1px solid #ddd;
            }

            #userTable td {
                display: block;
                text-align: right;
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
            }

            #userTable td:last-child {
                border-bottom: none;
            }

            #userTable td:before {
                content: attr(data-label);
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
            }
        }
    </style>
</head>
<body>

    <h1>사용자 관리 (Cloud Ver.)</h1>

    <form id="userForm">
        <input type="hidden" id="userId" name="userId">
        <div>
            <label for="name">이름:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div>
            <label for="age">나이:</label>
            <input type="number" id="age" name="age" required>
        </div>
        <div>
            <label for="height">키(cm):</label>
            <input type="number" id="height" name="height" required>
        </div>
        <div>
            <label for="weight">몸무게(kg):</label>
            <input type="number" id="weight" name="weight" required>
        </div>
        <div class="buttons">
            <button type="submit">저장</button>
            <button type="button" id="deleteButton">삭제</button>
            <button type="button" id="clearButton">새로 입력</button>
        </div>
    </form>

    <h2>사용자 목록</h2>
    <table id="userTable">
        <thead>
            <tr>
                <th>이름</th>
                <th>나이</th>
                <th>키(cm)</th>
                <th>몸무게(kg)</th>
            </tr>
        </thead>
        <tbody>
            <!-- User rows will be inserted here -->
        </tbody>
    </table>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js" type="module"></script>
    <script type="module">
        // Import the new Firestore-based functions
        import { loadUsers, saveUser, removeUser } from './firestore.js';

        const userForm = document.getElementById('userForm');
        const userIdField = document.getElementById('userId');
        const nameField = document.getElementById('name');
        const ageField = document.getElementById('age');
        const heightField = document.getElementById('height');
        const weightField = document.getElementById('weight');
        const userTableBody = document.querySelector('#userTable tbody');
        const deleteButton = document.getElementById('deleteButton');
        const clearButton = document.getElementById('clearButton');

        // Function to clear the form and reset selection
        function clearForm() {
            userForm.reset();
            userIdField.value = '';
            deleteButton.disabled = true;
            document.querySelectorAll('#userTable tbody tr').forEach(row => {
                row.classList.remove('active');
            });
        }

        // Function to render the user list in the table
        async function displayUsers() {
            userTableBody.innerHTML = '';
            const users = await loadUsers();
            
            users.forEach(user => {
                const row = userTableBody.insertRow();
                row.setAttribute('data-id', user.id);
                // Add data-label attributes for responsive CSS
                row.innerHTML = `
                    <td data-label="이름">${user.name}</td>
                    <td data-label="나이">${user.age}</td>
                    <td data-label="키(cm)">${user.height}</td>
                    <td data-label="몸무게(kg)">${user.weight}</td>
                `;
                row.addEventListener('click', () => {
                    document.querySelectorAll('#userTable tbody tr').forEach(r => r.classList.remove('active'));
                    row.classList.add('active');

                    userIdField.value = user.id;
                    nameField.value = user.name;
                    ageField.value = user.age;
                    heightField.value = user.height;
                    weightField.value = user.weight;
                    deleteButton.disabled = false;
                });
            });
        }

        // Handle form submission for saving/updating a user
        userForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const user = {
                id: userIdField.value || null,
                name: nameField.value,
                age: ageField.value,
                height: heightField.value,
                weight: weightField.value
            };
            await saveUser(user);
            clearForm();
            await displayUsers();
        });

        // Handle user deletion
        deleteButton.addEventListener('click', async () => {
            const userId = userIdField.value;
            if (userId && confirm('정말로 이 사용자를 삭제하시겠습니까?')) {
                await removeUser(userId);
                clearForm();
                await displayUsers();
            }
        });
        
        // Handle clear button click
        clearButton.addEventListener('click', clearForm);

        // Initial load of users when the page loads
        async function initialize() {
            clearForm();
            await displayUsers();
        }

        initialize();
    </script>

</body>
</html>
